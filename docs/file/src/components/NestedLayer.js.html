<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/components/NestedLayer.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.Control.js~Control.html">Control</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.MapEventManager.js~MapEventManager.html">MapEventManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.MapServerParser.js~MapServerParser.html">MapServerParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.MapSymbol.js~MapSymbol.html">MapSymbol</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.MapSymbology.js~MapSymbology.html">MapSymbology</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.NestedDynamicMapLayer.js~NestedDynamicMapLayer.html">NestedDynamicMapLayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.NestedGroupLayer.js~NestedGroupLayer.html">NestedGroupLayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Leaflet.TOC.NestedLayer.js~NestedLayer.html">NestedLayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateID">generateID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-applyStateChangeToLayer">applyStateChangeToLayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-applyStateChangeToTree">applyStateChangeToTree</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getLayerByID">getLayerByID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getLayerByLayerID">getLayerByLayerID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getLayerByUniqueProp">getLayerByUniqueProp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validateTreeEnabledState">validateTreeEnabledState</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/LeafletTOC.js~LeafletTOC.html">LeafletTOC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/MapSymbol.js~MapSymbol.html">MapSymbol</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/MapSymbology.js~MapSymbology.html">MapSymbology</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/NestedLayer.js~NestedLayer.html">NestedLayer</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/components/NestedLayer.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React from &apos;react&apos;;
import PropTypes from &apos;prop-types&apos;;
import classnames from &apos;classnames&apos;;

import MapEventManager from &apos;../Leaflet.TOC.MapEventManager&apos;;
import NL from &apos;../Leaflet.TOC.NestedLayer&apos;;
import MapSymbology from &apos;./MapSymbology&apos;;

export default class NestedLayer extends React.Component {

  static propTypes = {
    layer: PropTypes.instanceOf(NL).isRequired,
    toggleSelected: PropTypes.func.isRequired,
    visibilityChange: PropTypes.func.isRequired,
    eventManager: PropTypes.instanceOf(MapEventManager).isRequired
  };

  constructor(props) {
    super(props);

    this.eventManager = this.props.eventManager;
    console.log(&apos;NestedLayer received event manager&apos;, this.eventManager);
    let map = this.props.layer.map;
    let layer = this.props.layer.layer;
    console.log(&apos;NestedLayer asking event manager to bind layer&apos;, layer);
    this.eventManager.bindLayerToMapChanges(map, layer, this._mapEventHandler);

    // this.state = {
    //   _mapEventListeners: {
    //     &apos;zoomend&apos;: this._handleMapZoomChange,
    //     &apos;layeradd&apos;: this._handleMapLayerChange,
    //     &apos;layerremove&apos;: this._handleMapLayerChange
    //   }
    // };
  }

  _mapEventHandler = (e) =&gt; {
    console.log(&apos;&lt;NestedLayer /&gt; map event handler&apos;, e);
    this.props.visibilityChange();
  }

  // // add event listener(s) to map
  // bindToMapEvents() {
  //   console.log(&apos;binding to map events&apos;);

  //   this.props.layer.map.on(this.state._mapEventListeners);
  // }

  // // remove event listener(s) from map
  // unbindFromMapEvents() {
  //   console.log(&apos;unbinding from map events&apos;);
  //   this.props.layer.map.off(this.state._mapEventListeners);
  // }

  // // listens to zoomend
  // // http://leafletjs.com/reference-1.2.0.html#map-zoomend
  // _handleMapZoomChange = (e) =&gt; {
  //   console.log(&apos;zoom level changed to&apos;, e.target.getZoom());
  //   this.props.visibilityChange();
  // }

  // // listens to layeradd and layerremove
  // // http://leafletjs.com/reference-1.2.0.html#map-layeradd
  // // http://leafletjs.com/reference-1.2.0.html#map-layeradd
  // _handleMapLayerChange = (e) =&gt; {
  //   console.log(&apos;_handleMapLayerChange handles this layer?&apos;, e.layer._leaflet_id == this.props.layer.layer._leaflet_id);
  //   // if the change was to this layer (i.e. they share IDs)
  //   // this check helps throttle down React render() calls
  //   if (e.layer._leaflet_id == this.props.layer.layer._leaflet_id) {
  //     console.log(&apos;_handleMapLayerChange MATCH&apos;, e.layer, this.props.layer.layer);
  //     this.props.visibilityChange();
  //   }
  // }

  // componentDidMount() {
  //   this.bindToMapEvents();
  // }

  // componentWillUnmount() {
  //   this.unbindFromMapEvents();
  // }

  toggleSelected = () =&gt; {
    this.props.toggleSelected(this.props.layer);
  }

  visibilityChange = () =&gt; {
    this.props.visibilityChange();
  }

  friendlyLayerType = () =&gt; {
    return this.props.layer.constructor.name.replace(&apos;Nested&apos;, &apos;&apos;);
  }

  render() {
    const disabled = (this.props.layer.disabled ? &apos;disabled&apos; : &apos;&apos;);
    const classes = classnames({
      leaf: true,
      enabled: this.props.layer.enabled,
      disabled: this.props.layer.disabled,
      selected: this.props.layer.selected,
      deselected: this.props.layer.deselected,
      visible: this.props.layer.visible,
      invisible: !this.props.layer.visible
    });

    let children;

    if (this.props.layer.hasChildren) {
      // each child layer turns into a NestedLayer
      children = this.props.layer.children.map((layer) =&gt; &lt;NestedLayer layer={layer}
                                                                       toggleSelected={this.props.toggleSelected}
                                                                       visibilityChange={this.props.visibilityChange}
                                                                       eventManager={this.eventManager}
                                                                       key={layer.id} /&gt;);
      // wrap the children with a &lt;ul&gt;
      children = (
        &lt;ul className=&quot;branch&quot;&gt;
          {children}
        &lt;/ul&gt;
      )
    }

    return (
      &lt;li className={classes} &gt;
        &lt;input type=&quot;checkbox&quot; checked={this.props.layer.selected} disabled={disabled} onChange={this.toggleSelected} /&gt;
        &lt;span className=&quot;layer-name&quot;&gt;{this.props.layer.name}&lt;/span&gt;
        &lt;span className=&quot;layer-type&quot;&gt;{this.friendlyLayerType()}&lt;/span&gt;
        &lt;MapSymbology symbology={this.props.layer.symbology} /&gt;

        {children}

      &lt;/li&gt;
    );
  }

}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
